<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulacrum Data Analysis - Thejus Mahajan</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <!-- Prism.js for syntax highlighting -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
</head>

<body class="bg-gray-50 text-gray-700 flex flex-col min-h-screen">

    <header class="bg-white/80 backdrop-blur-md shadow-sm sticky top-0 z-40">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <a href="index.html" class="text-2xl font-bold text-gray-800">Thejus Mahajan</a>
            <div class="hidden md:flex space-x-6">
                <a href="index.html" class="text-gray-600 hover:text-sky-600 transition">About</a>
                <a href="experience.html" class="text-gray-600 hover:text-sky-600 transition">Experience</a>
                <a href="skills.html" class="text-gray-600 hover:text-sky-600 transition">Skills</a>
                <a href="projects.html" class="text-sky-600 font-semibold transition">Projects</a>
                <a href="blog.html" class="text-gray-600 hover:text-sky-600 transition">Blog</a>
                <a href="#contact" class="text-gray-600 hover:text-sky-600 transition">Contact</a>
            </div>
            <button id="mobile-menu-button" class="md:hidden flex items-center">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7">
                    </path>
                </svg>
            </button>
        </nav>
        <div id="mobile-menu" class="hidden md:hidden">
            <a href="index.html" class="block py-2 px-4 text-sm hover:bg-gray-200">About</a>
            <a href="experience.html" class="block py-2 px-4 text-sm hover:bg-gray-200">Experience</a>
            <a href="skills.html" class="block py-2 px-4 text-sm hover:bg-gray-200">Skills</a>
            <a href="projects.html" class="block py-2 px-4 text-sm hover:bg-gray-200">Projects</a>
            <a href="blog.html" class="block py-2 px-4 text-sm hover:bg-gray-200">Blog</a>
            <a href="#contact" class="block py-2 px-4 text-sm hover:bg-gray-200">Contact</a>
        </div>
    </header>

    <main class="container mx-auto px-6 py-12 flex-grow">

        <!-- Hero Section -->
        <section class="text-center py-12">
            <h1 class="text-4xl md:text-5xl font-bold text-gray-900 mb-4">Simulacrum Data Analysis</h1>
            <p class="text-xl text-gray-600 max-w-3xl mx-auto">
                A comprehensive biostatistical analysis of the Simulacrum v2.1.0 synthetic dataset, exploring patient
                demographics, tumour characteristics, and staging distributions.
            </p>
        </section>

        <!-- Data Description & Warnings -->
        <section class="py-8 max-w-4xl mx-auto">
            <div class="bg-yellow-50 border-l-4 border-yellow-400 p-6 mb-8 rounded-r-lg shadow-sm">
                <div class="flex">
                    <div class="flex-shrink-0">
                        <svg class="h-6 w-6 text-yellow-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                        </svg>
                    </div>
                    <div class="ml-4">
                        <h3 class="text-lg font-medium text-yellow-800">Important: Synthetic Data Warning</h3>
                        <div class="mt-2 text-yellow-700">
                            <p class="mb-2">
                                The data analyzed in this project is <strong>entirely synthetic</strong>. It comes from
                                the Simulacrum, a dataset derived from the National Disease Registration Service (NDRS)
                                in England.
                            </p>
                            <p>
                                While it mimics the structure and statistical properties of real cancer data, <strong>it
                                    does not contain real patient information</strong>. Results from this analysis
                                should <strong>not</strong> be compared to real-world clinical data or used to make
                                clinical decisions.
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <h2 class="section-title">About the Data</h2>
            <p class="text-lg leading-relaxed mb-6 text-gray-700">
                The Simulacrum is a tool developed by Health Data Insight (HDI) to facilitate cancer data research
                without compromising patient confidentiality. It allows researchers to write and test code on "safe"
                data that looks like the real thing.
            </p>
            <p class="text-sm text-gray-500 italic mb-12">
                <strong>Citation:</strong> The Simulacrum Version 2.1.0. Health Data Insight. Available at: <a
                    href="https://simulacrum.healthdatainsight.org.uk/"
                    class="text-sky-600 hover:underline">https://simulacrum.healthdatainsight.org.uk/</a>
            </p>
        </section>

        <!-- Part 1: Patient Demographics -->
        <section class="py-12 border-t border-gray-200">
            <h2 class="section-title">Part 1: Patient Demographics</h2>
            <p class="text-center text-gray-600 mb-12 max-w-2xl mx-auto">
                We begin by analyzing the `sim_av_patient.csv` dataset to understand the demographic composition of the
                cohort.
            </p>

            <!-- Patient Data Profiling -->
            <div class="bg-white rounded-xl shadow-sm p-8 mb-8 border border-gray-100">
                <div class="flex items-center gap-3 mb-6">
                    <div class="p-2 bg-blue-100 rounded-lg">
                        <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                        </svg>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-900">Patient Data Profiling</h2>
                </div>

                <div class="prose max-w-none text-gray-600 mb-8">
                    <p>
                        Before analyzing demographics, we inspected the <code>sim_av_patient</code> dataset to ensure
                        data quality and consistency.
                    </p>
                </div>

                <!-- Data Snapshot -->
                <div class="mb-8">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">Data Structure Snapshot</h3>
                    <p class="text-gray-600 mb-4">A sample of the raw records from the patient dataset:</p>
                    <div class="overflow-x-auto">
                        <table class="min-w-full text-sm text-left text-gray-500">
                            <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3">PATIENTID</th>
                                    <th class="px-6 py-3">GENDER</th>
                                    <th class="px-6 py-3">ETHNICITY</th>
                                    <th class="px-6 py-3">VITALSTATUS</th>
                                    <th class="px-6 py-3">VITALSTATUSDATE</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="bg-white border-b">
                                    <td class="px-6 py-4">10000001</td>
                                    <td class="px-6 py-4">1</td>
                                    <td class="px-6 py-4">A</td>
                                    <td class="px-6 py-4">A</td>
                                    <td class="px-6 py-4">2022-07-05</td>
                                </tr>
                                <tr class="bg-white border-b">
                                    <td class="px-6 py-4">10000002</td>
                                    <td class="px-6 py-4">1</td>
                                    <td class="px-6 py-4">nan</td>
                                    <td class="px-6 py-4">A</td>
                                    <td class="px-6 py-4">2022-07-05</td>
                                </tr>
                                <tr class="bg-white border-b">
                                    <td class="px-6 py-4">10000003</td>
                                    <td class="px-6 py-4">2</td>
                                    <td class="px-6 py-4">A</td>
                                    <td class="px-6 py-4">A</td>
                                    <td class="px-6 py-4">2022-07-05</td>
                                </tr>
                                <tr class="bg-white border-b">
                                    <td class="px-6 py-4">10000004</td>
                                    <td class="px-6 py-4">1</td>
                                    <td class="px-6 py-4">A</td>
                                    <td class="px-6 py-4">A</td>
                                    <td class="px-6 py-4">2022-07-05</td>
                                </tr>
                                <tr class="bg-white border-b">
                                    <td class="px-6 py-4">10000005</td>
                                    <td class="px-6 py-4">1</td>
                                    <td class="px-6 py-4">A</td>
                                    <td class="px-6 py-4">A</td>
                                    <td class="px-6 py-4">2022-07-05</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Pre-Analysis Checks -->
                <div class="bg-blue-50 border-l-4 border-blue-500 p-6 rounded-r-lg">
                    <h3 class="text-lg font-bold text-blue-800 mb-4">ðŸ›‘ Pre-Analysis Data Quality Checks</h3>
                    <div class="space-y-4">
                        <div>
                            <h4 class="font-bold text-blue-800">1. Gender Coding</h4>
                            <ul class="list-disc list-inside text-blue-700 ml-4">
                                <li><strong>Logic:</strong> Gender is coded as 0 (Not known), 1 (Male), 2 (Female), 9
                                    (Not specified).</li>
                                <li><strong>Check:</strong> Verified distribution of codes.</li>
                                <li><strong>Handling:</strong> Codes 0 and 9 were retained but labeled clearly as "Not
                                    known" or "Not specified". Empty categories were removed from plots.</li>
                            </ul>
                        </div>
                        <div>
                            <h4 class="font-bold text-blue-800">2. Vital Status Cleaning</h4>
                            <ul class="list-disc list-inside text-blue-700 ml-4">
                                <li><strong>Logic:</strong> Vital status contains codes like 'A' (Alive), 'D'
                                    (Deceased), and specific death codes (D3, D4).</li>
                                <li><strong>Handling:</strong> All 'D' variants were aggregated into a single 'Deceased'
                                    category for clarity.</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Gender Distribution -->
            <div class="grid md:grid-cols-2 gap-12 mb-16 items-center">
                <div>
                    <img src="images/gender_distribution.png" alt="Gender Distribution"
                        class="rounded-lg shadow-md w-full border border-gray-100">
                </div>
                <div>
                    <h3 class="text-2xl font-bold mb-4 text-gray-800">Gender Distribution</h3>
                    <p class="text-lg leading-relaxed mb-4 text-gray-700">
                        The dataset shows a relatively balanced distribution between male and female patients.
                    </p>
                    <p class="text-lg leading-relaxed mb-4 text-gray-700">
                        <strong>Critical Note:</strong> In real-world epidemiology, cancer incidence is rarely a perfect
                        50/50 split due to biological and lifestyle differences.
                        The even balance here likely reflects the <strong>synthetic nature</strong> of the dataset or
                        specific sampling parameters, rather than a biological truth.
                    </p>
                    <p class="text-lg leading-relaxed mb-4 text-gray-700">
                        This is a fundamental check to ensure the synthetic data generation process has not introduced
                        significant
                        gender bias, although specific cancer types (like prostate or breast cancer) are naturally
                        gender-specific.
                    </p>
                    <div class="bg-gray-50 p-4 rounded-lg border border-gray-200 overflow-x-auto">
                        <h4 class="text-sm font-bold text-gray-500 mb-2 uppercase tracking-wide">R Code:</h4>
                        <h4 class="text-sm font-bold text-gray-500 mb-2 uppercase tracking-wide">Python Code:</h4>
                        <pre class="bg-gray-800 text-gray-100 p-4 rounded-lg overflow-x-auto text-sm"><code># Python (Pandas/Seaborn)
# Map gender codes
gender_map = {0: "Not known", 1: "Male", 2: "Female", 9: "Not specified"}
df['GENDER_LABEL'] = df['GENDER'].map(gender_map)

# Filter out empty/unknown categories if they are effectively zero
gender_counts = df['GENDER_LABEL'].value_counts()
gender_counts = gender_counts[gender_counts > 0]

# Scale to Thousands
gender_counts_scaled = gender_counts / 1000

# Plot
plt.figure(figsize=(8, 6))
colors = ['lightblue' if x == 'Male' else 'pink' if x == 'Female' else 'gray' for x in gender_counts_scaled.index]
sns.barplot(x=gender_counts_scaled.index, y=gender_counts_scaled.values, palette=colors)
plt.title("Patient Gender Distribution")
plt.ylabel("Count (Thousands)")
plt.savefig("gender_distribution.png")</code></pre>
                    </div>
                </div>
            </div>

            <!-- Vital Status -->
            <div class="grid md:grid-cols-2 gap-12 items-center">
                <div class="order-2 md:order-1">
                    <h3 class="text-2xl font-bold mb-4 text-gray-800">Vital Status</h3>
                    <p class="text-lg leading-relaxed mb-4 text-gray-700">
                        The vital status analysis reveals the proportion of patients who are alive versus deceased
                        within the simulation.
                    </p>
                    <p class="text-lg leading-relaxed mb-4 text-gray-700">
                        <strong>Methodological Warning:</strong> The number of "Deceased" patients is a function of the
                        simulation's mortality curves and time horizon.
                        It should <strong>not</strong> be interpreted as a measure of biological "severity" without a
                        proper survival analysis (e.g., Kaplan-Meier curves), which accounts for time-at-risk.
                    </p>
                    <div class="bg-gray-50 p-4 rounded-lg border border-gray-200 overflow-x-auto">
                        <h4 class="text-sm font-bold text-gray-500 mb-2 uppercase tracking-wide">Python Code:</h4>
                        <pre class="bg-gray-800 text-gray-100 p-4 rounded-lg overflow-x-auto text-sm"><code># Python (Pandas/Seaborn)
# Clean Data: Map D3, D4, etc. to D
df['VITAL_CLEAN'] = df['VITALSTATUS'].apply(lambda x: 'D' if str(x).startswith('D') else ('A' if str(x) == 'A' else 'Other'))

# Filter: Keep only Alive (A) and Deceased (D)
df_vital = df[df['VITAL_CLEAN'].isin(['A', 'D'])].copy()
df_vital['STATUS_LABEL'] = df_vital['VITAL_CLEAN'].map({'A': 'Alive', 'D': 'Deceased'})

# Count and Scale
vital_counts = df_vital['STATUS_LABEL'].value_counts()
vital_counts_scaled = vital_counts / 1000

# Plot
plt.figure(figsize=(8, 6))
colors = ['lightgreen' if x == 'Alive' else 'salmon' for x in vital_counts_scaled.index]
sns.barplot(x=vital_counts_scaled.index, y=vital_counts_scaled.values, palette=colors)
plt.title("Patient Vital Status")
plt.ylabel("Count (Thousands)")
plt.savefig("vital_status_distribution.png")</code></pre>
                    </div>
                </div>
                <div class="order-1 md:order-2">
                    <img src="images/vital_status_distribution.png" alt="Vital Status Distribution"
                        class="rounded-lg shadow-md w-full border border-gray-100">
                </div>
            </div>
        </section>

        <!-- Part 2: Tumour Analysis -->
        <section class="py-12 border-t border-gray-200">
            <h2 class="section-title">Part 2: Tumour Analysis</h2>
            <p class="text-center text-gray-600 mb-12 max-w-2xl mx-auto">
                Next, we examine the `sim_av_tumour.csv` dataset to explore cancer types and staging.
            </p>

            <!-- Tumour Data Profiling -->
            <div class="bg-white rounded-xl shadow-sm p-8 mb-8 border border-gray-100">
                <div class="flex items-center gap-3 mb-6">
                    <div class="p-2 bg-purple-100 rounded-lg">
                        <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01">
                            </path>
                        </svg>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-900">Tumour Data Profiling & Quality Assessment</h2>
                </div>

                <div class="prose max-w-none text-gray-600 mb-8">
                    <p>
                        For the tumour analysis, we inspected the <code>sim_av_tumour</code> dataset, focusing on
                        diagnosis dates, cancer sites, and staging.
                    </p>
                </div>

                <!-- Data Snapshot -->
                <div class="mb-8">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">Data Structure Snapshot</h3>
                    <p class="text-gray-600 mb-4">A sample of the raw records from the joined tumour and patient
                        datasets:</p>
                    <div class="overflow-x-auto">
                        <table class="min-w-full text-sm text-left text-gray-500">
                            <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3">PATIENTID</th>
                                    <th class="px-6 py-3">DIAGNOSISDATEBEST</th>
                                    <th class="px-6 py-3">SITE_ICD10_O2</th>
                                    <th class="px-6 py-3">STAGE_BEST</th>
                                    <th class="px-6 py-3">VITALSTATUS</th>
                                    <th class="px-6 py-3">VITALSTATUSDATE</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="bg-white border-b">
                                    <td class="px-6 py-4">800129</td>
                                    <td class="px-6 py-4">2016-04-12</td>
                                    <td class="px-6 py-4">C50.9</td>
                                    <td class="px-6 py-4">2A</td>
                                    <td class="px-6 py-4">A</td>
                                    <td class="px-6 py-4">2019-12-31</td>
                                </tr>
                                <tr class="bg-white border-b">
                                    <td class="px-6 py-4">800130</td>
                                    <td class="px-6 py-4">2017-01-22</td>
                                    <td class="px-6 py-4">C34.1</td>
                                    <td class="px-6 py-4">4</td>
                                    <td class="px-6 py-4">D</td>
                                    <td class="px-6 py-4">2017-08-15</td>
                                </tr>
                                <tr class="bg-white border-b">
                                    <td class="px-6 py-4">800131</td>
                                    <td class="px-6 py-4">2015-11-05</td>
                                    <td class="px-6 py-4">C18.7</td>
                                    <td class="px-6 py-4">3</td>
                                    <td class="px-6 py-4">A</td>
                                    <td class="px-6 py-4">2019-12-31</td>
                                </tr>
                                <tr class="bg-white border-b">
                                    <td class="px-6 py-4">800132</td>
                                    <td class="px-6 py-4">2018-03-30</td>
                                    <td class="px-6 py-4">C61</td>
                                    <td class="px-6 py-4">?</td>
                                    <td class="px-6 py-4">A</td>
                                    <td class="px-6 py-4">2019-12-31</td>
                                </tr>
                                <tr class="bg-white border-b">
                                    <td class="px-6 py-4">800133</td>
                                    <td class="px-6 py-4">2016-09-14</td>
                                    <td class="px-6 py-4">D06.9</td>
                                    <td class="px-6 py-4">U</td>
                                    <td class="px-6 py-4">A</td>
                                    <td class="px-6 py-4">2019-12-31</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Pre-Analysis Checks -->
                <div class="bg-red-50 border-l-4 border-red-500 p-6 rounded-r-lg">
                    <h3 class="text-lg font-bold text-red-800 mb-4">ðŸ›‘ Pre-Analysis Data Quality Checks</h3>
                    <p class="text-red-700 mb-4">Before generating the visualizations, the following integrity checks
                        were performed to ensure biological and temporal consistency:</p>

                    <div class="space-y-4">
                        <div>
                            <h4 class="font-bold text-red-800">1. Temporal Consistency (Time-Travel Check)</h4>
                            <ul class="list-disc list-inside text-red-700 ml-4">
                                <li><strong>Logic:</strong> A patient cannot die before they are diagnosed.</li>
                                <li><strong>Check:</strong> Verified that
                                    <code>VITALSTATUSDATE &ge; DIAGNOSISDATE</code> for all records.
                                </li>
                                <li><strong>Handling:</strong> Records with negative survival times (if any) were
                                    flagged as data entry errors.</li>
                            </ul>
                        </div>

                        <div>
                            <h4 class="font-bold text-red-800">2. Scope Definition (The "Skin Cancer" Trap)</h4>
                            <ul class="list-disc list-inside text-red-700 ml-4">
                                <li><strong>Logic:</strong> Non-Melanoma Skin Cancers (ICD-10 C44) have extremely high
                                    incidence but low mortality. Including them in aggregate rankings distorts the scale
                                    of other cancers.</li>
                                <li><strong>Decision:</strong> C44 cases are excluded from the "Top 10 Cancer Types"
                                    ranking to align with standard reporting (e.g., NCRAS/CRUK methodology), though they
                                    are retained for overall volume counts.</li>
                            </ul>
                        </div>

                        <div>
                            <h4 class="font-bold text-red-800">3. Staging Granularity</h4>
                            <ul class="list-disc list-inside text-red-700 ml-4">
                                <li><strong>Observation:</strong> The dataset contains mixed granularity (e.g., Stage 1,
                                    1A, 1B).</li>
                                <li><strong>Cleaning:</strong> Sub-stages were aggregated into their parent integer
                                    stages (1-4) to allow for clear high-level comparison.</li>
                                <li><strong>Missing Data:</strong> A significant proportion of records are marked
                                    <code>?</code> or <code>U</code>. These were preserved as "Unknown" rather than
                                    dropped, as missing staging is a genuine feature of real-world cancer data (often
                                    correlating with patient age or rapid disease progression).
                                </li>
                            </ul>
                        </div>

                        <div>
                            <h4 class="font-bold text-red-800">4. Code Formatting</h4>
                            <ul class="list-disc list-inside text-red-700 ml-4">
                                <li><strong>Standardization:</strong> ICD-10 codes were truncated to the first 3
                                    characters (e.g., C50.9 &rarr; C50) to group subtypes into main organ systems (e.g.,
                                    All Breast Cancers).</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Cancer Sites -->
            <div class="grid md:grid-cols-2 gap-12 mb-16 items-center">
                <div>
                    <img src="images/top_10_cancer_sites.png" alt="Top 10 Cancer Sites"
                        class="rounded-lg shadow-md w-full border border-gray-100">
                </div>
                <div>
                    <h3 class="text-2xl font-bold mb-4 text-gray-800">Most Common Cancer Sites</h3>
                    <p class="text-lg leading-relaxed mb-4 text-gray-700">
                        We identified the most common cancer diagnoses by grouping the ICD-10 codes.
                    </p>
                    <p class="text-lg leading-relaxed mb-4 text-gray-700">
                        <strong>Epidemiological Correction:</strong> We explicitly <strong>excluded Non-Melanoma Skin
                            Cancer (C44)</strong> from this ranking.
                        While C44 is highly prevalent, it has a very low mortality rate and is standardly excluded from
                        "Top 10" cancer rankings to avoid skewing the data against more significant burdens like Lung or
                        Bowel cancer.
                    </p>
                    <div class="bg-gray-50 p-4 rounded-lg border border-gray-200 overflow-x-auto">
                        <h4 class="text-sm font-bold text-gray-500 mb-2 uppercase tracking-wide">Python Code:</h4>
                        <pre class="bg-gray-800 text-gray-100 p-4 rounded-lg overflow-x-auto text-sm"><code># Python (Pandas/Seaborn)
# Extract 3-char code
df['SITE_MAIN'] = df['SITE_ICD10_O2'].str[:3]

# Filter 1: Keep only Invasive (Starts with 'C')
df_invasive = df[df['SITE_MAIN'].str.startswith('C', na=False)].copy()

# Filter 2: Exclude C44 (NMSC)
df_final = df_invasive[df_invasive['SITE_MAIN'] != 'C44'].copy()

# Count Top 10
site_counts = df_final['SITE_MAIN'].value_counts().head(10)

# Map codes to names
icd10_map = {
    "C50": "Breast", "C61": "Prostate", "C34": "Lung", "C18": "Colon", 
    "C19": "Rectosigmoid", "C20": "Rectum", "C43": "Melanoma", 
    "C67": "Bladder", "C25": "Pancreas", "C64": "Kidney",
    "C54": "Uterus"
}
labels = [f"{code} ({icd10_map.get(code, code)})" for code in site_counts.index]

# Scale and Plot
site_counts_scaled = site_counts / 1000
sns.barplot(x=site_counts_scaled.values, y=labels, color="steelblue")
plt.title("Top 10 Invasive Cancer Sites (Excl. NMSC)")
plt.xlabel("Count (Thousands)")
plt.savefig("top_10_cancer_sites.png")</code></pre>
                    </div>
                </div>
            </div>

            <!-- Staging -->
            <div class="grid md:grid-cols-2 gap-12 items-center">
                <div class="order-2 md:order-1">
                    <h3 class="text-2xl font-bold mb-4 text-gray-800">Stage Distribution</h3>
                    <p class="text-lg leading-relaxed mb-4 text-gray-700">
                        Staging is a critical prognostic factor. The plot shows the distribution of cancer stages at
                        diagnosis.
                    </p>
                    <p class="text-lg leading-relaxed mb-4 text-gray-700">
                        <strong>Key Observation:</strong> A large portion of the data is marked as <strong>'?'
                            (Unknown)</strong> or <strong>'U' (Unstaged)</strong>. This is a realistic feature of cancer
                        registry data, often reflecting cases where staging was not possible due to patient health or
                        data collection issues. It highlights the importance of handling missing data in real-world
                        analysis.
                    </p>
                    <div class="bg-gray-50 p-4 rounded-lg border border-gray-200 overflow-x-auto">
                        <h4 class="text-sm font-bold text-gray-500 mb-2 uppercase tracking-wide">Python Code:</h4>
                        <pre class="bg-gray-800 text-gray-100 p-4 rounded-lg overflow-x-auto text-sm"><code># Python (Pandas/Seaborn)
def clean_stage(stage):
    stage = str(stage).upper().strip()
    if stage in ['?', 'U', 'NAN', 'nan']: return 'Unknown'
    # Aggregate 1A, 1B -> 1
    match = re.match(r'^([1-4])', stage)
    return match.group(1) if match else 'Unknown'

# Apply cleaning
df['STAGE_CLEAN'] = df['STAGE_BEST'].apply(clean_stage)

# Define Order: 1, 2, 3, 4, Unknown
stage_order = ['1', '2', '3', '4', 'Unknown']
stage_counts = df['STAGE_CLEAN'].value_counts().reindex(stage_order, fill_value=0)

# Scale and Plot
stage_counts_scaled = stage_counts / 1000
sns.barplot(x=stage_counts_scaled.index, y=stage_counts_scaled.values, color="seagreen")
plt.title("Distribution of Cancer Stages")
plt.ylabel("Count (Thousands)")
plt.savefig("stage_distribution.png")</code></pre>
                    </div>
                </div>
                <div class="order-1 md:order-2">
                    <img src="images/stage_distribution.png" alt="Stage Distribution"
                        class="rounded-lg shadow-md w-full border border-gray-100">
                </div>
            </div>
        </section>

        <div class="text-center mt-12">
            <a href="projects.html" class="text-sky-600 font-semibold hover:underline text-lg">&larr; Back to
                Projects</a>
        </div>

    </main>

    <footer id="contact" class="bg-gray-800 text-white mt-auto">
        <div class="container mx-auto px-6 py-12 text-center">
            <h2 class="text-3xl font-bold mb-4">Let's Connect</h2>
            <p class="mb-8 max-w-xl mx-auto">I'm currently seeking opportunities in bioinformatics and biostatistics.
            </p>
            <div class="flex justify-center space-x-6">
                <a href="mailto:thejusmahajan@gmail.com"
                    class="bg-sky-600 hover:bg-sky-700 text-white font-bold py-3 px-6 rounded-full transition-colors duration-300">Email
                    Me</a>
                <a href="https://www.linkedin.com/in/dr-thejus-mahajan-ph-d-85a4b087" target="_blank"
                    class="bg-gray-700 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-full transition-colors duration-300">LinkedIn</a>
                <a href="https://github.com/thejusmahajan" target="_blank"
                    class="bg-gray-700 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-full transition-colors duration-300">GitHub</a>
            </div>
            <p class="mt-10 text-gray-400 text-sm">&copy; 2025 Thejus Mahajan. All Rights Reserved.</p>
        </div>
    </footer>

    <script src="js/main.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-r.min.js"></script>
</body>

</html>